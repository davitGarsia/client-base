<div class="form-page">
  <div class="form-page--header">
    <h1 class="form-page--title">Client Form</h1>
  </div>
  <div class="form-page--content">
    <form class="form" [formGroup]="clientForm">
      <div class="form-item">
        <label for="client-number">კლიენტის ნომერი</label>
        <input type="text" id="client-number" pattern="\d*" (input)="onIntInput($event, 'clientNumber')" formControlName="clientNumber" class="input">
        @if (clientForm.get('clientNumber')?.invalid && (clientForm.get('clientNumber')?.touched || clientForm.get('clientNumber')?.dirty)) {
          @if (clientForm.get('clientNumber')?.hasError('required')) {
            <small class="error-text">Client number is required.</small>
          }
          @if (clientForm.get('clientNumber')?.hasError('nonInteger')) {
            <small class="error-text">Client number must be a number.</small>
          }
          @if (clientForm.get('clientNumber')?.hasError('clientNumberTaken')) {
            <small class="error-text">Client number must be unique.</small>
          }
        }
      </div>

      <div class="single-line">
        <div class="form-item">
          <label for="name">სახელი</label>
          <input type="text" id="name" formControlName="name" class="input">
          @if (clientForm.get('name')?.invalid && (clientForm.get('name')?.touched || clientForm.get('name')?.dirty)) {
            @if (clientForm.get('name')?.hasError('required')) {
              <small class="error-text">Name is required.</small>
            }
            @if (clientForm.get('name')?.hasError('minlength')) {
              <small class="error-text">Name must be at least 2 characters long.</small>
            }
            @if (clientForm.get('name')?.hasError('maxlength')) {
              <small class="error-text">Name must be at most 50 characters long.</small>
            }
            @if (clientForm.get('name')?.hasError('mixedLanguages')) {
              <small class="error-text">Name must contain Georgian or Latin letters</small>
            }
          }
        </div>
        <div class="form-item">
          <label for="last-name">გვარი</label>
          <input type="text" id="last-name" formControlName="lastName" class="input">
            @if (clientForm.get('lastName')?.invalid && (clientForm.get('lastName')?.touched || clientForm.get('lastName')?.dirty)) {
                @if (clientForm.get('lastName')?.hasError('required')) {
                <small class="error-text">Last name is required.</small>
                }
                @if (clientForm.get('lastName')?.hasError('minlength')) {
                <small class="error-text">Last name must be at least 2 characters long.</small>
                }
                @if (clientForm.get('lastName')?.hasError('maxlength')) {
                <small class="error-text">Last name must be at most 50 characters long.</small>
                }
                @if (clientForm.get('lastName')?.hasError('mixedLanguages')) {
                <small class="error-text">Last name must contain Georgian or Latin letters</small>
                }
            }
        </div>
      </div>

      <div class="form-item">
        <label for="gender">სქესი</label>
        <input type="text" id="gender" formControlName="gender" class="input">
        @if (clientForm.get('gender')?.invalid && (clientForm.get('gender')?.touched)) {
          <small class="error-text">gender is a must</small>
        }
      </div>
      <div class="form-item">
        <label for="personal-number">პირადი ნომერი</label>
        <input type="text" id="personal-number" maxlength="11" pattern="\d*" (input)="onIntInput($event, 'personal-number')" formControlName="personalNumber" class="input">
        @if (clientForm.get('personalNumber')?.invalid && (clientForm.get('personalNumber')?.touched || clientForm.get('personalNumber')?.dirty)) {
          @if (clientForm.get('personalNumber')?.hasError('required')) {
            <small class="error-text">Personal number is required.</small>
          }
          @if (clientForm.get('personalNumber')?.hasError('nonInteger')) {
            <small class="error-text">Personal number must be a number.</small>
          }
          @if (clientForm.get('personalNumber')?.hasError('personalNumberTaken')) {
            <small class="error-text">Personal number must be unique.</small>
          }
          @if (clientForm.get('personalNumber')?.hasError('minlength')) {
            <small class="error-text">Personal number must be at least 11 characters long.</small>
          }
            @if (clientForm.get('personalNumber')?.hasError('maxlength')) {
                <small class="error-text">Personal number must be at most 11 characters long.</small>
            }
        }
      </div>
      <div class="form-item">
        <label for="phone">ტელეფონი</label>
        <input type="text" id="phone" formControlName="phone" class="input">
        @if (clientForm.get('phone')?.invalid && (clientForm.get('phone')?.touched || clientForm.get('phone')?.dirty)) {
          @if (clientForm.get('phone')?.hasError('required')) {
            <small class="error-text">Phone is required.</small>
          }
          @if (clientForm.get('phone')?.hasError('minlength')) {
            <small class="error-text">Phone must be at least 9 characters long.</small>
          }
          @if (clientForm.get('phone')?.hasError('maxlength')) {
            <small class="error-text">Phone must be at most 9 characters long.</small>
          }
          @if (clientForm.get('phone')?.hasError('nonInteger')) {
            <small class="error-text">Phone must be a number.</small>
          }
          @if (clientForm.get('phone')?.hasError('notStartingWithFive')) {
            <small class="error-text">Phone must start with 5.</small>
          }
        }
      </div>

      <div class="">
        <p class="sub-para">იურიდიული მისამართი</p>
        <div class="form-group address--container" formGroupName="officialAddress">
          <div class="single-line">
            <div class="form-item">
              <label for="country">Country</label>
              <input class="input" id="country" formControlName="country" />
              @if (clientForm.get('officialAddress.country')?.invalid &&
              (clientForm.get('officialAddress.country')?.touched || clientForm.get('officialAddress.country')?.dirty)) {
                @if (clientForm.get('officialAddress.country')?.hasError('required')) {
                  <small class="error-text">Country is required.</small>
                }
              }
            </div>
            <div class="form-item">
              <label for="city">City</label>
              <input class="input" id="city" formControlName="city" />
              @if (clientForm.get('officialAddress.city')?.invalid &&
              (clientForm.get('officialAddress.city')?.touched || clientForm.get('officialAddress.city')?.dirty)) {
                @if (clientForm.get('officialAddress.city')?.hasError('required')) {
                  <small class="error-text">City is required.</small>
                }
              }
            </div>
            </div>
          <div class="form-item">
            <label for="address">Address</label>
            <input class="input" id="address" formControlName="address" />
            @if (clientForm.get('officialAddress.address')?.invalid &&
            (clientForm.get('officialAddress.address')?.touched || clientForm.get('officialAddress.address')?.dirty)) {
              @if (clientForm.get('officialAddress.address')?.hasError('required')) {
                <small class="error-text">Address is required.</small>
              }
            }
          </div>
        </div>

      </div>

      <div class="">
       <div class="form-group address--container" formGroupName="factualAddress">
         <p class="sub-para">ფაქტობრივი მისამართი</p>
         <div class="form-group">
           <div class="single-line">
             <div class="form-item">
               <label for="addr-country">Country</label>
               <input class="input" id="addr-country" formControlName="country" />
               @if (clientForm.get('factualAddress.country')?.invalid &&
               (clientForm.get('factualAddress.country')?.touched || clientForm.get('factualAddress.country')?.dirty)) {
                 @if (clientForm.get('factualAddress.country')?.hasError('required')) {
                   <small class="error-text">Country is required.</small>
                 }
               }
             </div>

             <div class="form-item">
               <label for="addr-city">City</label>
               <input class="input" id="addr-city" formControlName="city" />
               @if (clientForm.get('factualAddress.city')?.invalid &&
               (clientForm.get('factualAddress.city')?.touched || clientForm.get('factualAddress.city')?.dirty)) {
                 @if (clientForm.get('factualAddress.city')?.hasError('required')) {
                   <small class="error-text">City is required.</small>
                 }
               }
             </div>
           </div>
           </div>
         <div class="form-item">
           <label for="factual-address">Address</label>
           <input class="input" id="factual-address" formControlName="address" />
           @if (clientForm.get('factualAddress.address')?.invalid &&
           (clientForm.get('factualAddress.address')?.touched || clientForm.get('factualAddress.address')?.dirty)) {
             @if (clientForm.get('factualAddress.address')?.hasError('required')) {
               <small class="error-text">Address is required.</small>
             }
           }
         </div>
        </div>
      </div>

      <div class="img-upload">
        <p class="sub-para">სურათი</p>

        <div class="image-container">
          <div class="image">
            @if (photoSignal()) {
              <img class="img" [src]="photoSignal()" alt="client pic" />
              <button pTooltip="სურათის წაშლა" class="btn-delete" (click)="removePhoto()">
                <i  class="icon pi pi-times-circle"></i>
              </button>
            }
          </div>

          <div class="file-upload-container">
            <label for="file-input" class="custom-file-upload">
              <i class="pi pi-upload"></i>
              ატვირთვა
              <input
                formControlName="photo"
                id="file-input"
                type="file"
                accept="image/*, .jpeg, .png, .jpg"
                class="file-input"
                (change)="onFileChange($event)"
              />
            </label>
          </div>
        </div>
      </div>

      <hr class="hr">

    </form>
    <div class="button-container">
      <button class="btn btn-cancel" [routerLink]="'/clients'">გაუქმება</button>
      <button class="btn btn-primary" [disabled]="clientForm.invalid" [class.disabled]="clientForm.invalid" (click)="onSubmit()">{{isEditMode() ? 'რედაქტირება' : 'შენახვა'}}</button>
    </div>

</div>
</div>
