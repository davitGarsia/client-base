<div class="form-page">
  <div class="form-page--header">
    <h1 class="form-page--title">Account Form</h1>
  </div>
  <div class="form-page--content">
<form class="form" [formGroup]="accountForm">
  <div class="form-item">
    <label for="clientNumber">Client Number</label>
    <input class="input" id="clientNumber" (input)="onIntInput($event, 'clientNumber')" formControlName="clientNumber" type="text">
    @if (accountForm.get('clientNumber')?.invalid && accountForm.get('clientNumber')?.touched) {
      @if (accountForm.get('clientNumber')?.hasError('required')) {
        <small>client number is required.</small>
      }
      @if (accountForm.get('clientNumber')?.hasError('integerValidator')) {
        <small>client number must be an integer.</small>
      }
      @if (accountForm.get('clientNumber')?.hasError('clientNumberTaken')) {
        <small>client number must be unique</small>
      }

    }
  </div>

  <div formArrayName="account">
    @for (account of getAccount(); let i = $index; track i) {
      <div [formGroupName]="i">
        <div class="form-item">
          <label for="accountNumber{{i}}">Account Number</label>
          <input class="input" id="accountNumber{{i}}" (input)="onIntInput($event, 'accountNumber')" formControlName="accountNumber" type="text">
          @if (account.get('accountNumber')?.invalid && account.get('accountNumber')?.touched || account.get('accountNumber')?.dirty) {
            @if (account.get('accountNumber')?.hasError('required')) {
              <small>Account number is required.</small>
            }
            @if (account.get('accountNumber')?.hasError('integerValidator')) {
              <small>Account number must be an integer.</small>
            }
            @if (account.get('accountNumber')?.hasError('accountNumberTaken')) {
              <small>Account number must be unique</small>
            }
          }
        </div>

        <div class="form-item">
          <label for="accountType{{i}}">Account Type</label>
          <div class="custom-select-wrapper">
            <select class="custom-select" formControlName="accountType">
              <option value="" disabled selected>აირჩიეთ</option>
              <option value="current">მიმდინარე</option>
              <option value="keeping">შემნახველი</option>
              <option value="savings">დაგროვებითი</option>
            </select>
          </div>

          @if (account.get('accountType')?.invalid && account.get('accountType')?.touched) {
            @if (account.get('accountType')?.hasError('required')) {
              <small>Account type is required.</small>
            }
          }
        </div>

        <div class="single-line">
          <div class="form-item">
            <label for="currency{{i}}">Currency</label>
            <div class="custom-select-wrapper">
              <select class="custom-select" formControlName="currency">
                <option value="" disabled selected>აირჩიეთ</option>
                <option value="GEL">GEL</option>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
              </select>
            </div>
            @if (account.get('currency')?.invalid && account.get('currency')?.touched) {
              @if (account.get('currency')?.hasError('required')) {
                <small>Currency is required.</small>
              }
            }
          </div>

          <div class="form-item">
            <label for="accountStatus{{i}}">Account Status</label>
            <div class="custom-select-wrapper">
              <select class="custom-select" formControlName="accountStatus">
                <option value="" disabled selected>აირჩიეთ</option>
                <option value="active">აქტიური</option>
                <option value="closed">დახურული</option>
              </select>
            </div>
            @if (account.get('accountStatus')?.invalid && account.get('accountStatus')?.touched) {
              @if (account.get('accountStatus')?.hasError('required')) {
                <small>Account status is required.</small>
              }
            }
          </div>
        </div>
        @if (i > 0) {
          <button (click)="removeAccount(i)">ანგარიშის წაშლა</button>
        }
      </div>
    }
    <button (click)="addAccount()">ანგარიშის დამატება</button>
  </div>

  <button type="submit" (click)="onSubmit()">Submit</button>
</form>
  </div>
</div>
